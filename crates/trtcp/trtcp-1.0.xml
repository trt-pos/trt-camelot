<protocol byte-order="big-endian" version="1.0">
    <requests>
        <head>
            <field name="version" type="u16" />
            <field name="patch" type="u16" />
            <field name="caller" type="string">
                <description>
                    Name of the client.
                    Matches regex [a-zA-Z0-9_]+
                </description>
            </field>
        </head>
        <unit-separator value="0x1F"/>
        <action>
            <field name="action" type="action-type" />
            <field name="module:id" type="string" optional="true">
                <description>
                    The module and id of the action
                    Ex.: plugin-cash-register:orderModified
                </description>
            </field>
        </action>
        <unit-separator value="0x1F"/>
        <body>
            <field name="action-data" type="[u8]" />
        </body>
    </requests>
    <responses>
        <head>
            <field name="version" type="u16" />
            <field name="patch" type="u16" />
            <field name="caller" type="string" >
                <description>
                    The caller is the same name as in the request
                    Matches regex [a-zA-Z0-9_\-]+
                </description>
            </field>
        </head>
        <unit-separator value="0x1F"/>
        <status>
            <field name="status" type="status-code" />
        </status>
        <unit-separator value="0x1F"/>
        <body>
            <field name="response-data" type="[u8]" />
        </body>
    </responses>
    <calls>
        <head>
            <field name="version" type="u16" />
            <field name="patch" type="u16" />
            <field name="caller" type="string" >
                <description>
                    The caller is the name of the event that is being listened to when receiving a call
                </description>
            </field>
        </head>
        <unit-separator value="0x1F"/>
        <body>
            <field name="call-data" type="[u8]" />
        </body>
    </calls>
    <action-type type="u8">
        <values>
            <value name="connect" value="0" >
                <requires-body value="no" />
                <description>
                    Establish the first connection server-client
                    and saves the client using the caller field provided in the head
                </description>
            </value>
            <value name="listen" value="1" >
                <requires-body value="no"/>
                <description>
                    Subscribe a listener to the designed id
                </description>
            </value>
            <value name="invoke" value="2" >
                <requires-body value="yes"/>
                <description>
                    Invoke all the listeners subscribed to the id. The body content is the data to be sent to the listeners,
                    and its obtained from the request
                </description>
            </value>
            <value name="create" value="3" >
                <requires-body value="yes"/>
                <description>
                    Create a new listener with the provided id
                </description>
            </value>
            <value name="leave" value="4" >
                <requires-body value="no"/>
                <description>
                    Unsubscribe the listener from the id
                </description>
            </value>
        </values>
    </action-type>
    <status-code type="i8">
        <values>
            <value name="OK" value="0" />
            <value name="GenericError" value="-1" />
            <value name="NeedConnection" value="-2" />
            <value name="AlreadyConnected" value="1" />
            <value name="InvalidRequest" value="2" />
        </values>
    </status-code>
</protocol>

